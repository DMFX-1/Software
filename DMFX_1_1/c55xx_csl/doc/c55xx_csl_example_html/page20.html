<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>C55XX CSL LP EXAMPLE: CSL USB EXAMPLE DOCUMENTATION</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">C55XX CSL LP EXAMPLE
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">CSL USB EXAMPLE DOCUMENTATION </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="USB6"></a>
USB EXAMPLE6 - USB CDC TEST</h1>
<h2><a class="anchor" id="USB6x"></a>
TEST DESCRIPTION:</h2>
<p>This test is to verify the operation of the CSL USB and CDC ACM module. This test runs in interrupt mode. USB interrupts are configured and ISR is registered using CSL INTC module. After initializing and configuring the USB module, the test program waits on a while loop. When there is any input from the USB host application USB ISR is triggered and the requested operation is performed inside the ISR.</p>
<p>This USB CDC test can be verified by any terminal program (such as HyperTerminal) which can send or receive data via the virtual COM port for the USB CDC. The attached INF file (C5515_CDC_ACM.inf) is required. The INF file only be installed for the C5515 USB CDC device for the first time, when the using driver wizard of the windriver. This installation is required only when running this example for the first time.</p>
<p>NOTE: IN THE CURRENT CODE EP1 IN IS CONFIGURED FOR COMMUNICATION CLASS INTERFACE EP2 OUT (BULK OUT) AND EP3 (BULK IN) IN ARE CONFIGURED FOR DATA CLASS INTERFACE THOSE CAN BE CHANGED IN CSL_CDC.H</p>
<p>NOTE: THIS TEST HAS BEEN DEVELOPED TO WORK WITH CHIP VERSIONS C5535, C5515, AND C5517. MAKE SURE THAT PROPER CHIP VERSION MACRO IS DEFINED IN THE FILE c55xx_csl\inc\csl_general.h.</p>
<h2><a class="anchor" id="USB2y"></a>
TEST PROCEDURE:</h2>
<ul>
<li>Connect the C5535/15/17 EVM with a PC via USB cable </li>
<li>Open the CCS and connect the target (C5535/C5515/C5517 EVM) </li>
<li>Open, build and load the USB program to the target </li>
<li>Set the PLL frequency to 100MHz </li>
<li>Run the program loaded on to the target </li>
<li>Install the inf file for the USB device (Only when running for first time) </li>
<li>After the proper USB enumeration, check the Control Panel&ndash;&gt;System&ndash;&gt;Hardware&ndash;&gt; Device Manager&ndash;&gt;Ports (COM &amp; LPT) looking for C5515_CDC_ACM_device. A COM port will be assigned to the CDC ACM device, says COM16 </li>
<li>Run the HyperTerminal. Create a new connection to COM16 </li>
<li>Configure the new connection to the desired baud rate, parity, number of bits etc. </li>
<li>The test program is acting as an echo device, whatever you input in the HyperTerminal, it will be echo them back. The user input to the HyperTerminal will be sent to the C5515 EVM via CSL_CDC_BULK_OUT_EP (EP2 OUT) and the data output from C5515 EVM to the will be sent to HyperTerminal via USB CSL_CDC_BULK_IN_EP (EP3 IN). You can change the actual port number in csl_cdc.h </li>
<li>Repeat the test at the following PLL frequencies C5515: 60MHz and 100MHz C5517: 60MHz, 100MHz, 150MHz and 200MHz C5535 eZdsp: 60MHz and 100MHz </li>
<li>Repeat the test in Release mode</li>
</ul>
<h2><a class="anchor" id="USB2z"></a>
TEST RESULT:</h2>
<ul>
<li>USB CDC ACM device should be detected by the host PC and should be accessible through a terminal application (HyperTerminal) </li>
<li>Data typed in using keyborad and data displayed on the terminal window should match <hr/>
</li>
</ul>
<h1><a class="anchor" id="USB7"></a>
USB EXAMPLE7 - USB HID CLASS TEST</h1>
<h2><a class="anchor" id="USB7x"></a>
TEST DESCRIPTION:</h2>
<p>This test is to verify the operation of the CSL USB HID module. This test initializes the USB HID module, SAR module to read the push button values, the test program then waits in a while loop for the user input through push buttons. The EVM will act as an HID (mouse) device and the PC will act as the Host. Using the push buttons present on the EVM, we can send the mouse commands to the Host PC, from EVM.</p>
<p>This test can be verified by pressing the push buttons on the EVM, and observing whether the corresponding mouse operation is performed on the Host PC.</p>
<pre class="fragment">Digital values corresponding to the button voltage will vary slightly
depending on the system clock value. Below are the range of mouse commands
corresponding to each push button of the EVM

 UP:   To move the mouse cursor to up from current cursor position
 DN:   To move the mouse cursor to down from current cursor position
 RWD:  To move the mouse cursor to left from current cursor position
 FWD:  To move the mouse cursor to right from current cursor position
 MENU: To send the Right Click command
 MODE: To send the Left Click command
 STOP: To stop the Program</pre><p>NOTE: THIS TEST HAS BEEN DEVELOPED TO WORK WITH CHIP VERSIONS C5515 AND C5517. MAKE SURE THAT PROPER CHIP VERSION MACRO IS DEFINED IN THE FILE c55xx_csl\inc\csl_general.h.</p>
<h2><a class="anchor" id="USB2y"></a>
TEST PROCEDURE:</h2>
<ul>
<li>Connect the C5515/17 EVM with a PC via USB cable </li>
<li>Open the CCS and connect the target (C5515/C5517 EVM) </li>
<li>Open, build and load the USB program to the target </li>
<li>Set the PLL frequency to 100MHz </li>
<li>Run the program loaded on to the target </li>
<li>After the proper USB enumeration, check the Control Panel&ndash;&gt;System&ndash;&gt; Hardware&ndash;&gt;Device Manager&ndash;&gt;Ports (COM &amp; LPT) looking for Human Interface Devices. </li>
<li>The test program is acting as an HID device(mouse), whatever you input through the push bottons, it will be sent as mouse commands to the host PC. </li>
<li>Repeat the test at the following PLL frequencies C5515: 60MHz and 100MHz C5517: 60MHz, 100MHz, 150MHz and 200MHz C5535 eZdsp: 60MHz and 100MHz </li>
<li>Repeat the test in Release mode</li>
</ul>
<h2><a class="anchor" id="USB2z"></a>
TEST RESULT:</h2>
<ul>
<li>USB HID Class device should be detected by the host PC and the user should be able to interact to the PC using the EVM as a mouse. </li>
<li>Push Buttons pressed on the EVM, will be read and the respective mouse commands will be sent to the Host PC. <hr/>
</li>
</ul>
<h1><a class="anchor" id="USB3"></a>
USB EXAMPLE3 - DMA MODE TEST</h1>
<h2><a class="anchor" id="USB3x"></a>
TEST DESCRIPTION:</h2>
<p>This test is to verify the operation of the CSL USB module.This test runs in DMA mode. USB controller is having DMA module internal to it. This DMA can be used to exchange the data between USB FIFO and the CPU memory. USB interrupt are used to indicate the arrival of request from the host. USB interrupts are configured and ISR is registered using CSL INTC module. After initializing and configuring the USB module test waits on a while loop. When there is any request from the USB host application USB ISR is triggered and the requested operation is performed inside the ISR. Inside the ISR FIFO read and write operations are performed using CPPI DMA module.</p>
<p>This USB test can be verified by a host USB tool which can send/receive data to/from the USB device. This tool should be installed on the host PC for evaluating the CSL USB end point examples. Please contact TI for more details on the USB host tool</p>
<p>NOTE: THIS TEST HAS BEEN DEVELOPED TO WORK WITH CHIP VERSIONS C5535, C5515 AND C5517. MAKE SURE THAT PROPER CHIP VERSION MACRO IS DEFINED IN THE FILE c55xx_csl\inc\csl_general.h.</p>
<h2><a class="anchor" id="USB1y"></a>
TEST PROCEDURE:</h2>
<ul>
<li>Open the CCS and connect the target (C5535/C5515/C5517 EVM) </li>
<li>Open, build and load the USB program to the target </li>
<li>Set the PLL frequency to 100MHz </li>
<li>Run the program loaded on to the target </li>
<li>Run the USB host application. It displays following message <pre class="fragment">      DeviceAttach: received and accepted attach for vendor id 0x451, product id 0x901
    0, interface 0, device handle 0x00392AD8

    Main Menu (active Dev/Prod/Interface/Alt. Setting: 0x451/0x9010/0/0)
      ----------
      1. Display device configurations
      2. Change interface alternate setting
      3. Reset Pipe
      4. Read/Write from pipes
      6. Selective Suspend
      7. Refresh
      99. Exit
      Enter option:</pre></li>
</ul>
<ul>
<li>Numbers from 1 to 99 should be entered to execute the operation given against each number</li>
</ul>
<ul>
<li>Choose the option 6 to change the transfer mode to single blocking</li>
</ul>
<ul>
<li>For read and write operations, choose option 4 which displays below messages <pre class="fragment">    Control pipe:
      pipe num. 0x0: packet size 64, type Control, dir In &amp; Out, interval 0 (ms)
    Interface 0
    Alternate Setting: 0
      pipe num. 0x81: packet size 512, type Bulk, dir In, interval 0 (ms)
      pipe num. 0x1: packet size 512, type Bulk, dir Out, interval 0 (ms)
      pipe num. 0x82: packet size 512, type Bulk, dir In, interval 0 (ms)
      pipe num. 0x2: packet size 512, type Bulk, dir Out, interval 0 (ms)
      pipe num. 0x83: packet size 512, type Bulk, dir In, interval 0 (ms)
      pipe num. 0x3: packet size 512, type Bulk, dir Out, interval 0 (ms)
      pipe num. 0x84: packet size 512, type Bulk, dir In, interval 0 (ms)
      pipe num. 0x4: packet size 512, type Bulk, dir Out, interval 0 (ms)

    Read/Write from/to device's pipes using Streaming Data Transfers
    ---------------------
    1.  Read from pipe
    2.  Write to pipe
    3.  Listen to pipe (continuous read)
    4.  Check streaming READ speed
    5.  Check streaming WRITE speed
    6.  Switch to Single Blocking Transfers mode
    99. Main menu
   Enter option:
* </pre></li>
</ul>
<ul>
<li>All the pipe numbers (end points) available for data transfers with supported data direction (IN/OUT) will be listed as shown above. In the current version of CSL USB end point example, four end points are supported with each end point capable of transferring and receiving data</li>
</ul>
<ul>
<li>For writing data from host to device, choose an end point number with 'OUT' direction. Enter the data size to be transferred and enter the data bytes to be transferred. Perform at least one write operation to an end point before reading data from it. Please check below log messages for write operation</li>
</ul>
<pre class="fragment">    Enter option: 2

    Please enter the pipe number (hex): 0x1
    Please enter the size of the buffer (dec):  4
    Please enter the input buffer (hex): 0xABCD1234
    Transferred 4 bytes
* </pre><ul>
<li>For reading data from device to host, choose an end point number with 'IN' direction. Enter the data size to be received. Data size entered for reading should be same as the size of data written previously. Please check below log messages for read operation</li>
</ul>
<pre class="fragment">    Enter option: 1

    Please enter the pipe number (hex): 0x81
    Please enter the size of the buffer (dec):  4
    Transferred 4 bytes
    AB CD 12 34
* </pre><ul>
<li>For verifying the USB operations write few bytes of data to an end point, read same number of bytes from that end point and compare the data read and data written. Data read should be same as data written for a given end point</li>
</ul>
<ul>
<li>Data read/write operations for a specific end point are independent of other end points. Data can be written to any end point any number of times with out effecting data buffers of other end points.</li>
</ul>
<ul>
<li>Repeat the test at the following PLL frequencies C5515: 60MHz and 100MHz C5517: 60MHz, 100MHz, 150MHz and 200MHz C5535 eZdsp: 60MHz and 100MHz </li>
<li>Repeat the test in Release mode</li>
</ul>
<ul>
<li>Limitations of the test This example and the host test code are implemented to show case how to configure and use the CSL USB module at end point level, but they are not intended to demo full-fledged USB application.</li>
</ul>
<p>Length of data that can be transferred on any end point in this test should be multiple of 4. Read/Write operations with data length other than multiple of 4 from host can result in unexpected behavior of the test</p>
<p>For any endpoint, first operation should be write which can be followed by several read operations. Reading data from an end point without writing data will result in timeout error for USB host tool</p>
<p>Data size read from an end point should always be equal to the size of data written previously to that end point.</p>
<p>Read operation for an end point always returns data written previously to that end point</p>
<h2><a class="anchor" id="USB1z"></a>
TEST RESULT:</h2>
<ul>
<li>USB device should be detected by the host PC and should be accessible through the USB host application </li>
<li>Data written and data read should match in the host application <hr/>
</li>
</ul>
<h1><a class="anchor" id="USB2"></a>
USB EXAMPLE2 - INTERRUPT MODE TEST</h1>
<h2><a class="anchor" id="USB2x"></a>
TEST DESCRIPTION:</h2>
<p>This test is to verify the operation of the CSL USB module.This test runs in interrupt mode. USB interrupts are configured and ISR is registered using CSL INTC module. After initializing and configuring the USB module test waits on a while loop. When there is any request from the USB host application USB ISR is triggered and the requested operation is performed inside the ISR.</p>
<p>This USB test can be verified by a host USB tool which can send/receive data to/from the USB device. This tool should be installed on the host PC for evaluating the CSL USB end point examples. Please contact TI for more details on the USB host tool</p>
<p>NOTE: THIS TEST HAS BEEN DEVELOPED TO WORK WITH CHIP VERSIONS C5535, C5515 AND C5517. MAKE SURE THAT PROPER CHIP VERSION MACRO IS DEFINED IN THE FILE c55xx_csl\inc\csl_general.h.</p>
<h2><a class="anchor" id="USB1y"></a>
TEST PROCEDURE:</h2>
<ul>
<li>Open the CCS and connect the target (C5535/C5515/C5517 EVM) </li>
<li>Open, build and load the USB program to the target </li>
<li>Set the PLL frequency to 100MHz </li>
<li>Run the program loaded on to the target </li>
<li>Run the USB host application. It displays following message <pre class="fragment">      DeviceAttach: received and accepted attach for vendor id 0x451, product id 0x901
    0, interface 0, device handle 0x00392AD8

    Main Menu (active Dev/Prod/Interface/Alt. Setting: 0x451/0x9010/0/0)
      ----------
      1. Display device configurations
      2. Change interface alternate setting
      3. Reset Pipe
      4. Read/Write from pipes
      6. Selective Suspend
      7. Refresh
      99. Exit
      Enter option:</pre></li>
</ul>
<ul>
<li>Numbers from 1 to 99 should be entered to execute the operation given against each number</li>
</ul>
<ul>
<li>Choose the option 6 to change the transfer mode to single blocking</li>
</ul>
<ul>
<li>For read and write operations, choose option 4 which displays below messages <pre class="fragment">    Control pipe:
      pipe num. 0x0: packet size 64, type Control, dir In &amp; Out, interval 0 (ms)
    Interface 0
    Alternate Setting: 0
      pipe num. 0x81: packet size 512, type Bulk, dir In, interval 0 (ms)
      pipe num. 0x1: packet size 512, type Bulk, dir Out, interval 0 (ms)
      pipe num. 0x82: packet size 512, type Bulk, dir In, interval 0 (ms)
      pipe num. 0x2: packet size 512, type Bulk, dir Out, interval 0 (ms)
      pipe num. 0x83: packet size 512, type Bulk, dir In, interval 0 (ms)
      pipe num. 0x3: packet size 512, type Bulk, dir Out, interval 0 (ms)
      pipe num. 0x84: packet size 512, type Bulk, dir In, interval 0 (ms)
      pipe num. 0x4: packet size 512, type Bulk, dir Out, interval 0 (ms)

    Read/Write from/to device's pipes using Streaming Data Transfers
    ---------------------
    1.  Read from pipe
    2.  Write to pipe
    3.  Listen to pipe (continuous read)
    4.  Check streaming READ speed
    5.  Check streaming WRITE speed
    6.  Switch to Single Blocking Transfers mode
    99. Main menu
   Enter option:
* </pre></li>
</ul>
<ul>
<li>All the pipe numbers (end points) available for data transfers with supported data direction (IN/OUT) will be listed as shown above. In the current version of CSL USB end point example, four end points are supported with each end point capable of transferring and receiving data</li>
</ul>
<ul>
<li>For writing data from host to device, choose an end point number with 'OUT' direction. Enter the data size to be transferred and enter the data bytes to be transferred. Perform at least one write operation to an end point before reading data from it. Please check below log messages for write operation</li>
</ul>
<pre class="fragment">    Enter option: 2

    Please enter the pipe number (hex): 0x1
    Please enter the size of the buffer (dec):  4
    Please enter the input buffer (hex): 0xABCD1234
    Transferred 4 bytes
* </pre><ul>
<li>For reading data from device to host, choose an end point number with 'IN' direction. Enter the data size to be received. Data size entered for reading should be same as the size of data written previously. Please check below log messages for read operation</li>
</ul>
<pre class="fragment">    Enter option: 1

    Please enter the pipe number (hex): 0x81
    Please enter the size of the buffer (dec):  4
    Transferred 4 bytes
    AB CD 12 34
* </pre><ul>
<li>For verifying the USB operations write few bytes of data to an end point, read same number of bytes from that end point and compare the data read and data written. Data read should be same as data written for a given end point</li>
</ul>
<ul>
<li>Data read/write operations for a specific end point are independent of other end points. Data can be written to any end point any number of times with out effecting data buffers of other end points.</li>
</ul>
<ul>
<li>Repeat the test at the following PLL frequencies C5515: 60MHz and 100MHz C5517: 60MHz, 100MHz, 150MHz and 200MHz C5535 eZdsp: 60MHz and 100MHz </li>
<li>Repeat the test in Release mode</li>
</ul>
<ul>
<li>Limitations of the test This example and the host test code are implemented to show case how to configure and use the CSL USB module at end point level, but they are not intended to demo full-fledged USB application.</li>
</ul>
<p>For any endpoint, first operation should be write which can be followed by several read operations. Reading data from an end point without writing data will result in timeout error for USB host tool</p>
<p>Data size read from an end point should always be equal to the size of data written previously to that end point.</p>
<p>Read operation for an end point always returns data written previously to that end point</p>
<h2><a class="anchor" id="USB1z"></a>
TEST RESULT:</h2>
<ul>
<li>USB device should be detected by the host PC and should be accessible through the USB host application </li>
<li>Data written and data read should match in the host application <hr/>
</li>
</ul>
<p>NOTE: For Testing MSC module a macro CSL_MSC_TEST needs to be defined This includes some code in csl_usbAux.h file which is essential for MSC operation and not required for MUSB stand alone testing. define this macro in predefined symbols in project build options (Defined in the current usb msc example pjt).Semaphores and mail boxes are used in the MSC example code as the USB operation is not possible with out OS calls. DSP BIOS is used for this purpose. Defining Start transfer and complete transfer call back functions is must and MSC module does not work if they are not implemented properly. A call back is sent to this functions from MUSB module.</p>
<h2><a class="anchor" id="USB1y"></a>
TEST PROCEDURE:</h2>
<ul>
<li>Open the CCS and connect the target (C5535/C5515/C5517 EVM) </li>
<li>Open, build and load the USB program to the target </li>
<li>Set the PLL frequency to 100MHz </li>
<li>Run the program loaded on to the target </li>
<li>A new Storage device should appear in "My Computer". Open the drive and do some file transfers. </li>
<li>Repeat the test at the following PLL frequencies C5515: 60MHz and 100MHz C5517: 60MHz, 100MHz, 150MHz and 200MHz C5535 eZdsp: 60MHz and 100MHz </li>
<li>Repeat the test in Release mode</li>
</ul>
<h2><a class="anchor" id="USB1z"></a>
TEST RESULT:</h2>
<ul>
<li>USB Storage device should be detected by the host PC and the file transfers should be successful </li>
<li>File transfers done using the example should be as desired, when the SD card contents are viewed when connected to the PC using a Card Reader</li>
</ul>
<p>NOTE: THIS TEST HAS BEEN DEVELOPED TO WORK WITH CHIP VERSIONS C5505, C5515, AND C5517. MAKE SURE THAT PROPER CHIP VERSION MACRO IS DEFINED IN THE FILE c55xx_csl\inc\csl_general.h.</p>
<p>Path: /(CSLPATH)/example/usb/example4/csl_usb_msc_dma_example</p>
<p>NOTE: For Testing MSC module a macro CSL_MSC_TEST needs to be defined This includes some code in csl_usbAux.h file which is essential for MSC operation and not required for MUSB stand alone testing. Define this macro in pre defined symbols in project build options (Defined in the current usb msc example pjt). Semaphores and mail boxes are used in the MSC example code as the USB operation is not possible with out OS calls. DSP BIOS is used for this purpose. Defining Start transfer and complete transfer call back functions is a must. MSC module does not work if they are not implemented properly. A call back is sent to this functions from MUSB module.</p>
<p>NOTE: THIS TEST HAS BEEN DEVELOPED TO WORK WITH CHIP VERSIONS C5505, C5515, AND C5517. MAKE SURE THAT PROPER CHIP VERSION MACRO IS DEFINED IN THE FILE c55xx_csl\inc\csl_general.h.</p>
<h2><a class="anchor" id="USB1y"></a>
TEST PROCEDURE:</h2>
<ul>
<li>Open the CCS and connect the target (C5535/C5515/C5517 EVM) </li>
<li>Open, build and load the USB program to the target </li>
<li>Set the PLL frequency to 100MHz </li>
<li>Run the program loaded on to the target </li>
<li>A new Storage device should appear in "My Computer". Open the drive and do some file transfers. </li>
<li>Repeat the test at the following PLL frequencies C5515: 60MHz and 100MHz C5517: 60MHz, 100MHz, 150MHz and 200MHz C5535 eZdsp: 60MHz and 100MHz </li>
<li>Repeat the test in Release mode</li>
</ul>
<h2><a class="anchor" id="USB1z"></a>
TEST RESULT:</h2>
<ul>
<li>USB Storage device should be detected by the host PC and the file transfers should be successful </li>
<li>File transfers done using the example should be as desired, when the SD card contents are viewed when connected to the PC using a Card Reader</li>
</ul>
<p>Path: /(CSLPATH)/example/usb/example4/csl_usb_msc_poll_example</p>
<p>NOTE: For Testing MSC module a macro CSL_MSC_TEST needs to be defined This includes some code in csl_usbAux.h file which is essential for MSC operation and not required for MUSB stand alone testing. define this macro in pre defined symbols in project build options (Defined in the current usb msc example pjt). Semaphores and mail boxes are used in the MSC example code as the USB operation is not possible with out OS calls. DSP BIOS is used for this purpose. Defining Start transfer and complete transfer call back functions is must and MSC module does not work if they are not implemented properly. A call back is sent to this functions from MUSB module.</p>
<p>NOTE: THIS TEST HAS BEEN DEVELOPED TO WORK WITH CHIP VERSIONS C5505, C5515 AND C5517. MAKE SURE THAT PROPER CHIP VERSION MACRO IS DEFINED IN THE FILE c55xx_csl\inc\csl_general.h.</p>
<h2><a class="anchor" id="USB1y"></a>
TEST PROCEDURE:</h2>
<ul>
<li>Open the CCS and connect the target (C5535/C5515/C5517 EVM) </li>
<li>Open, build and load the USB program to the target </li>
<li>Set the PLL frequency to 100MHz </li>
<li>Run the program loaded on to the target </li>
<li>A new Storage device should appear in "My Computer". Open the drive and do some file transfers. </li>
<li>Repeat the test at the following PLL frequencies C5515: 60MHz and 100MHz C5517: 60MHz, 100MHz, 150MHz and 200MHz C5535 eZdsp: 60MHz and 100MHz </li>
<li>Repeat the test in Release mode </li>
</ul>
<h2><a class="anchor" id="USB1z"></a>
TEST RESULT:</h2>
<ul>
<li>USB Storage device should be detected by the host PC and the file transfers should be successful </li>
<li>File transfers done using the example should be as desired, when the SD card contents are viewed when connected to the PC using a Card Reader</li>
</ul>
<p>Path: /(CSLPATH)/example/usb/example4/csl_usb_msc_poll_example</p>
<h1><a class="anchor" id="USB1"></a>
USB EXAMPLE1 - POLL MODE TEST</h1>
<h2><a class="anchor" id="USB1x"></a>
TEST DESCRIPTION:</h2>
<p>This test is to verify the operation of the CSL USB module. This test runs in poll mode. In the poll mode interrupt registers are read continuously in a while loop. If there is any interrupt observed it will be served and test continues to poll for the next interrupts.</p>
<p>This USB test can be verified by a host USB tool which can send/receive data to/from the USB device. This tool should be installed on the host PC for evaluating the CSL USB end point examples. Please contact TI for more details on the USB host tool</p>
<p>NOTE: THIS TEST HAS BEEN DEVELOPED TO WORK WITH CHIP VERSIONS C5535, C5515 AND C5517. MAKE SURE THAT PROPER CHIP VERSION MACRO IS DEFINED IN THE FILE c55xx_csl\inc\csl_general.h.</p>
<h2><a class="anchor" id="USB1y"></a>
TEST PROCEDURE:</h2>
<ul>
<li>Open the CCS and connect the target (C5535/C5515/C5517 EVM) </li>
<li>Open, build and load the USB program to the target </li>
<li>Set the PLL frequency to 100MHz </li>
<li>Run the program loaded on to the target </li>
<li>Run the USB host application. It displays following message <pre class="fragment">      DeviceAttach: received and accepted attach for vendor id 0x451, product id 0x901
    0, interface 0, device handle 0x00392AD8

    Main Menu (active Dev/Prod/Interface/Alt. Setting: 0x451/0x9010/0/0)
      ----------
      1. Display device configurations
      2. Change interface alternate setting
      3. Reset Pipe
      4. Read/Write from pipes
      6. Selective Suspend
      7. Refresh
      99. Exit
      Enter option:</pre></li>
</ul>
<ul>
<li>Numbers from 1 to 99 should be entered to execute the operation given against each number</li>
</ul>
<ul>
<li>Choose the option 6 to change the transfer mode to single blocking</li>
</ul>
<ul>
<li>For read and write operations, choose option 4 which displays below messages <pre class="fragment">    Control pipe:
      pipe num. 0x0: packet size 64, type Control, dir In &amp; Out, interval 0 (ms)
    Interface 0
    Alternate Setting: 0
      pipe num. 0x81: packet size 512, type Bulk, dir In, interval 0 (ms)
      pipe num. 0x1: packet size 512, type Bulk, dir Out, interval 0 (ms)
      pipe num. 0x82: packet size 512, type Bulk, dir In, interval 0 (ms)
      pipe num. 0x2: packet size 512, type Bulk, dir Out, interval 0 (ms)
      pipe num. 0x83: packet size 512, type Bulk, dir In, interval 0 (ms)
      pipe num. 0x3: packet size 512, type Bulk, dir Out, interval 0 (ms)
      pipe num. 0x84: packet size 512, type Bulk, dir In, interval 0 (ms)
      pipe num. 0x4: packet size 512, type Bulk, dir Out, interval 0 (ms)

    Read/Write from/to device's pipes using Streaming Data Transfers
    ---------------------
    1.  Read from pipe
    2.  Write to pipe
    3.  Listen to pipe (continuous read)
    4.  Check streaming READ speed
    5.  Check streaming WRITE speed
    6.  Switch to Single Blocking Transfers mode
    99. Main menu
   Enter option:
* </pre></li>
</ul>
<ul>
<li>All the pipe numbers (end points) available for data transfers with supported data direction (IN/OUT) will be listed as shown above. In the current version of CSL USB end point example, four end points are supported with each end point capable of transferring and receiving data</li>
</ul>
<ul>
<li>For writing data from host to device, choose an end point number with 'OUT' direction. Enter the data size to be transferred and enter the data bytes to be transferred. Perform at least one write operation to an end point before reading data from it. Please check below log messages for write operation</li>
</ul>
<pre class="fragment">    Enter option: 2

    Please enter the pipe number (hex): 0x1
    Please enter the size of the buffer (dec):  4
    Please enter the input buffer (hex): 0xABCD1234
    Transferred 4 bytes
* </pre><ul>
<li>For reading data from device to host, choose an end point number with 'IN' direction. Enter the data size to be received. Data size entered for reading should be same as the size of data written previously. Please check below log messages for read operation</li>
</ul>
<pre class="fragment">    Enter option: 1

    Please enter the pipe number (hex): 0x81
    Please enter the size of the buffer (dec):  4
    Transferred 4 bytes
    AB CD 12 34
* </pre><ul>
<li>For verifying the USB operations write few bytes of data to an end point, read same number of bytes from that end point and compare the data read and data written. Data read should be same as data written for a given end point</li>
</ul>
<ul>
<li>Data read/write operations for a specific end point are independent of other end points. Data can be written to any end point any number of times with out effecting data buffers of other end points.</li>
</ul>
<ul>
<li>Repeat the test at the following PLL frequencies C5515: 60MHz and 100MHz C5517: 60MHz, 100MHz, 150MHz and 200MHz C5535 eZdsp: 60MHz and 100MHz </li>
<li>Repeat the test in Release mode</li>
</ul>
<ul>
<li>Limitations of the test This example and the host test code are implemented to show case how to configure and use the CSL USB module at end point level, but they are not intended to demo full-fledged USB application.</li>
</ul>
<p>For any endpoint, first operation should be write which can be followed by several read operations. Reading data from an end point without writing data will result in timeout error for USB host tool</p>
<p>Data size read from an end point should always be equal to the size of data written previously to that end point.</p>
<p>Read operation for an end point always returns data written previously to that end point</p>
<h2><a class="anchor" id="USB1z"></a>
TEST RESULT:</h2>
<ul>
<li>USB device should be detected by the host PC and should be accessible through the USB host application </li>
<li>Data written and data read should match in the host application <hr/>
 </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Apr 12 2013 15:14:33 for C55XX CSL LP EXAMPLE by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
